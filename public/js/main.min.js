"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var __DEV=!0,version=.001,compatible="9ICXM7PGXJ",__DOMAIN="example.com";String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Lib=function(){function Lib(){_classCallCheck(this,Lib)}return _createClass(Lib,null,[{key:"randString",value:function(length,lower,upper,numbers){var text="",possible="",possLower="abcdefghijklmnopqrstuvwxyz",possUpper="ABCDEFGHIJKLMNOPQRSTUVWXYZ";lower&&(possible+=possLower),upper&&(possible+=possUpper),numbers&&(possible+=posNum);for(var i=0;i<length;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}},{key:"weightedRandom",value:function(obj){var total=0;for(var key in obj)total+=obj[key];var r=Math.random()*total;for(var key in obj){if(r<obj[key])return key;r-=obj[key]}}},{key:"deepCopy",value:function(obj){return JSON.parse(JSON.stringify(obj))}},{key:"isObjEmpty",value:function(obj){if(null==obj)return!0;if(obj.length>0)return!1;if(0===obj.length)return!0;for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}},{key:"numToColorNameProper",value:function(num){var colors=["White","Purple","Blue","Green","Yellow","Orange","Red"];return"undefined"!=typeof colors[num]?colors[num]:colors[0]}},{key:"betweenTwoNum",value:function(fromNum,toNum,zeroToOneComplete){var distance=toNum-fromNum;return fromNum+distance*zeroToOneComplete}},{key:"socialMediaPost",value:function(site,url){"facebook"==site?window.open("http://www.facebook.com/share.php?u="+url,"Facebook","width=550,height=400"):"twitter"==site&&window.open("http://twitter.com/intent/tweet?status="+url,"Twitter","width=550,height=400")}}]),Lib}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),WebSocketClass=function(){function WebSocketClass(){_classCallCheck(this,WebSocketClass),this.server=0,this.connected=!1}return _createClass(WebSocketClass,[{key:"startWebSocket",value:function(){var _this=this;return!this.connected&&(__DEV?this.server=new WebSocket("ws://localhost:7777"):this.server=new WebSocket("ws://ws."+__DOMAIN+"/"),this.server.binaryType="arraybuffer",this.server.onopen=function(){_this.connected=!0,_this.sendObj({m:"compatible",v:compatible})},this.server.onclose=function(){_this.connected=!1,PO.ready=!1,$("#homepage").removeClass("hide"),$("#maingame").addClass("hide"),$("#waiting").addClass("hide")},void(this.server.onmessage=function(e){var d=e.data;if("string"==typeof e.data)if(d=JSON.parse(d),console.log(d),"compatible"==d.m)0==d.v&&alert("Your game is out of date, try refreshing the browser.");else if("ready"==d.m)$("#waiting").addClass("hide"),_this.sendObj({m:"start",n:PO.name,t:PO.type});else if("wait"==d.m)$("#waiting").removeClass("hide");else if("go"==d.m){Game.data.players.list=d.players,Game.data.myId=d.id,Game.data.map=d.map,Game.data.serverTick=d.tick,Game.data.minimapTick=d.minitick,Game.data.config.blocksize=d.block,Game.draw.map(),Game.draw.minimap(),PO.ready=!0,$("#homepage").addClass("hide"),$("#maingame").removeClass("hide"),$("#chat-log").html(""),Game.chatMessage("Press [Enter] to open/close chat.","game"),Game.chatMessage("You can only chat with "+Lib.numToColorNameProper(Game.data.players.list["p"+Game.data.myId].color)+" players.","game");d.id}else"dead"==d.m?($("#respawn").removeClass("hide"),Game.chatMessage("You're Dead!","game")):"killed"==d.m?Game.chatMessage("You killed '"+d.v+"'","game"):"dcplayer"==d.m?"undefined"!=typeof Game.data.players.list["p"+d.v]&&delete Game.data.players.list["p"+d.v]:"newplayer"==d.m?Game.data.players.list["p"+d.v.id]=d.v:"oom"==d.m?Game.chatMessage("You've sent too many messages (try again in 10 seconds)","game"):"tm"==d.m?$("#chat-log").prepend($("<div />").addClass("team").addClass(Lib.numToColorNameProper(Game.data.players.list["p"+Game.data.myId].color).toLowerCase()).text("[ "+Game.data.players.list["p"+d.id].name+" ]  "+d.v)):"ping"==d.m&&Game.chatMessage("Ping: "+(Date.now()-d.v)+"ms","game");else{var x=new Int8Array(d);if(5==x[0]&&(Game.data.oldPlayers.rank=Game.data.players.rank,Game.data.players.rank=WS.unpackBinary(d,16),Game.data.players.rank.sort(function(a,b){return a[1]<b[1]?1:a[1]>b[1]?-1:0}),$("#ranks").html(""),Game.data.players.rank.forEach(function(e,i){var id=e[0];Game.data.players.list["p"+id].rank=e[1],Game.data.players.list["p"+id].level=e[2];var flipLevelColor=2-parseFloat(e[2])/3e3,modLevelColor=(flipLevelColor+.35)%1;Game.data.players.list["p"+id].levelColor=Game.color.hslToHex(modLevelColor,1,.5);var myRank="";id==Game.data.myId&&(myRank="myrank"),e[1]<=10?$("#ranks").prepend($("<div />").addClass(Lib.numToColorNameProper(Game.data.players.list["p"+id].color).toLowerCase()).addClass(myRank).append($("<span />").text(""+e[1]+" - ")).append($("<span />").text(Game.data.players.list["p"+id].name))):id==Game.data.myId&&$("#ranks").append($("<div />").addClass(Lib.numToColorNameProper(Game.data.players.list["p"+id].color).toLowerCase()).addClass(myRank).append($("<span />").text(""+e[1]+" - ")).append($("<span />").text(Game.data.players.list["p"+id].name)))})),6==x[0]&&(Game.data.oldPlayers.minimap=Game.data.players.minimap,Game.data.players.minimap=WS.unpackBinary(d,16)),7==x[0]&&(Game.data.oldPlayers.tick=Game.data.players.tick,Game.data.players.tick=WS.unpackBinary(d,16)),8==x[0]&&(Game.data.lasers=Game.data.lasers.concat(WS.unpackBinary(d,16))),9==x[0]){var blockChages=WS.unpackBinary(d,16);blockChages.forEach(function(e,i){var mapX=e[0],mapY=e[1];Game.data.map[mapY][mapX]=e[2]}),Game.draw.map(),Game.draw.minimap()}}}))}},{key:"unpackBinary",value:function(data,bitSize){var binaryData=!1;8==bitSize&&(binaryData=new Int8Array(data)),16==bitSize&&(binaryData=new Int16Array(data)),32==bitSize&&(binaryData=new Int32Array(data));for(var currentDate=Date.now(),mainArray=[],singleArray=[],k=2;k<binaryData.length;k++)singleArray.push(binaryData[k]),singleArray.length==binaryData[1]&&(singleArray.push(currentDate),mainArray.push(singleArray),singleArray=[]);return mainArray}},{key:"stopWebSocket",value:function(){this.connected&&this.server.close()}},{key:"sendObj",value:function(object){return 0==this.connected?(alert("WebSocket is not connected."),!1):void this.server.send(JSON.stringify(object))}}]),WebSocketClass}(),WS=new WebSocketClass,PlayerOutput=function(){function PlayerOutput(){_classCallCheck(this,PlayerOutput),this.ready=!1,this.name="",this.type=0,this.chatMode=!1,this.thrusterState=!1,this.weaponState=!1,this.tickEmpty=0,this.tickchanged=!1,this.tick={},this.tick.direction=this.tickEmpty,this.tick.thruster=this.tickEmpty,this.tick.weapon=this.tickEmpty,this.tick.message=this.tickEmpty,this.loopDelay=50,this.harvestLoop()}return _createClass(PlayerOutput,[{key:"thrust",value:function(on){on&&0==this.thrusterState?(PO.tick.thruster=1,PO.thrusterState=!0,PO.tickchanged=!0):on||1!=this.thrusterState||(1==PO.tick.thruster?PO.tick.thruster=3:PO.tick.thruster=2,PO.thrusterState=!1,PO.tickchanged=!0)}},{key:"weapon",value:function(on){on&&0==this.weaponState?(PO.tick.weapon=1,PO.weaponState=!0,PO.tickchanged=!0):on||1!=this.weaponState||(1==PO.tick.weapon?PO.tick.weapon=3:PO.tick.weapon=2,PO.weaponState=!1,PO.tickchanged=!0)}},{key:"harvestLoop",value:function(){var _this2=this;if(setTimeout(function(){setTimeout(function(){_this2.harvestLoop()},1)},this.loopDelay),this.tickchanged){var tickArray=[2];for(var key in this.tick)this.tick.hasOwnProperty(key)&&(tickArray.push(this.tick[key]),this.tick[key]=this.tickEmpty);WS.connected&&WS.sendObj(tickArray),this.tickchanged=!1}}}]),PlayerOutput}(),PO=new PlayerOutput,GameClass=function(){function GameClass(){var _this3=this;_classCallCheck(this,GameClass),this.center={x:$(window).width()/2,y:$(window).height()/2},this.view={x:2e3,y:1e3},this.zoomLevel=3,this.renderer=PIXI.autoDetectRenderer(this.view.x,this.view.y,{backgroundColor:"0x000000"}),this.renderer.baseResolution={width:this.renderer.width,height:this.renderer.height},$("#maingame").append(this.renderer.view),this.rendererMinimap=PIXI.autoDetectRenderer(400,400,{backgroundColor:"0x000000"}),this.rendererMinimap.baseResolution={width:this.rendererMinimap.width,height:this.rendererMinimap.height},$("#minimap").append(this.rendererMinimap.view),this.data={},this.data.config={},this.data.config.health={},this.data.config.health.style="circle",this.data.config.health.alpha=.5,this.data.config.health.color="player",this.data.config.background={},this.data.config.background.style="grid",this.data.config.background.color="dark",this.data.map=[],this.data.players={tick:[],list:[],minimap:[],rank:[]},this.data.oldPlayers={tick:[],list:[],minimap:[],rank:[]},this.data.lasers=[],this.data.myId=0,this.data.serverTick=1e3,this.data.minimapTick=1e3,this.render={},this.render.world=new PIXI.Container,this.render.camera=new PIXI.Container,this.render.text=new PIXI.Container,this.render.map=new PIXI.Graphics,this.render.players=new PIXI.Graphics,this.render.lasers=new PIXI.Graphics,this.render.miniworld=new PIXI.Container,this.render.minimap=new PIXI.Graphics,this.render.miniplayers=new PIXI.Graphics,this.render.backgroundImageDark=PIXI.Texture.fromImage("images/colorfog.jpg"),this.render.backgroundImageLight=PIXI.Texture.fromImage("images/colorfoglight.jpg"),this.render.background=new PIXI.extras.TilingSprite(this.render.backgroundImageDark,1e3,1e3),this.render.names=[],this.render.world.addChild(this.render.camera),this.render.camera.addChild(this.render.background),this.render.camera.addChild(this.render.map),this.render.camera.addChild(this.render.players),this.render.camera.addChild(this.render.lasers),this.render.camera.addChild(this.render.text),this.render.miniworld.addChild(this.render.minimap),this.render.miniworld.addChild(this.render.miniplayers),this.draw={},this.draw.map=function(){var blocksize=_this3.data.config.blocksize,mapPixels=blocksize*_this3.data.map.length,mapLength=_this3.data.map.length;_this3.render.background.width=mapPixels,_this3.render.background.height=mapPixels,_this3.render.map.clear();var mapColor={};if("light"==_this3.data.config.background.color?(_this3.render.background.texture=_this3.render.backgroundImageLight,_this3.renderer.backgroundColor="0xffffff",mapColor.outline="0x999999",mapColor.mainGridLine="0xCCCCCC",mapColor.sideGridLine="0xDDDDDD",mapColor.colorGrid="0xEEEEEE"):(_this3.render.background.texture=_this3.render.backgroundImageDark,_this3.renderer.backgroundColor="0x000000",mapColor.outline="0xffffff",mapColor.mainGridLine="0x333333",mapColor.sideGridLine="0x222222",mapColor.colorGrid="0x111111"),"grid"==_this3.data.config.background.style){_this3.render.map.beginFill(mapColor.colorGrid),_this3.render.map.lineStyle(0,"0xffffff",1),_this3.render.map.drawRect(0,0,mapPixels,mapPixels),_this3.render.map.endFill();for(var i=0;i<mapLength;i++)_this3.render.map.lineStyle(4,mapColor.mainGridLine,1),_this3.render.map.moveTo(i*blocksize,0),_this3.render.map.lineTo(i*blocksize,mapPixels),_this3.render.map.lineStyle(4,mapColor.sideGridLine,1),_this3.render.map.moveTo(i*blocksize+Math.floor(.33*blocksize),0),_this3.render.map.lineTo(i*blocksize+Math.floor(.33*blocksize),mapPixels),_this3.render.map.moveTo(i*blocksize+Math.floor(.66*blocksize),0),_this3.render.map.lineTo(i*blocksize+Math.floor(.66*blocksize),mapPixels);for(var k=0;k<mapLength;k++)_this3.render.map.lineStyle(4,mapColor.mainGridLine,1),_this3.render.map.moveTo(0,k*blocksize),_this3.render.map.lineTo(mapPixels,k*blocksize),_this3.render.map.lineStyle(4,mapColor.sideGridLine,1),_this3.render.map.moveTo(0,k*blocksize+Math.floor(.33*blocksize)),_this3.render.map.lineTo(mapPixels,k*blocksize+Math.floor(.33*blocksize)),_this3.render.map.moveTo(0,k*blocksize+Math.floor(.66*blocksize)),_this3.render.map.lineTo(mapPixels,k*blocksize+Math.floor(.66*blocksize))}_this3.data.map.forEach(function(element,index){element.forEach(function(e,i){if(0!=e){var offset={x:i*blocksize,y:index*blocksize},border=6;_this3.render.map.lineStyle(0,"0xffffff",1),_this3.render.map.beginFill(mapColor.outline),_this3.render.map.drawRect(offset.x,offset.y,blocksize,blocksize),_this3.render.map.endFill(),_this3.render.map.beginFill(_this3.color.numToColor(e)),_this3.render.map.drawRect(offset.x+border,offset.y+border,blocksize-2*border,blocksize-2*border),_this3.render.map.endFill(),_this3.render.map.lineStyle(20,"0x999999",1),21==e?(_this3.render.map.moveTo(offset.x+blocksize/2,offset.y+.25*blocksize),_this3.render.map.lineTo(offset.x+blocksize/2,offset.y+.75*blocksize),_this3.render.map.moveTo(offset.x+.25*blocksize,offset.y+blocksize/2),_this3.render.map.lineTo(offset.x+.75*blocksize,offset.y+blocksize/2)):22==e?(_this3.render.map.drawCircle(offset.x+blocksize/2,offset.y+blocksize/2,blocksize/3),_this3.render.map.drawCircle(offset.x+blocksize/2,offset.y+blocksize/2,blocksize/5)):23==e?(_this3.render.map.moveTo(offset.x+.15*blocksize,offset.y+.7*blocksize),_this3.render.map.bezierCurveTo(offset.x+.3*blocksize,offset.y+.3*blocksize,offset.x+.7*blocksize,offset.y+.7*blocksize,offset.x+.85*blocksize,offset.y+.3*blocksize)):24==e&&(_this3.render.map.moveTo(offset.x+.15*blocksize,offset.y+.6*blocksize),_this3.render.map.lineTo(offset.x+.65*blocksize,offset.y+.6*blocksize),_this3.render.map.moveTo(offset.x+.35*blocksize,offset.y+.4*blocksize),_this3.render.map.lineTo(offset.x+.85*blocksize,offset.y+.4*blocksize))}})})},this.draw.minimap=function(){var blocksize=_this3.rendererMinimap.baseResolution.width/_this3.data.map.length;_this3.render.minimap.clear(),_this3.data.map.forEach(function(element,index){element.forEach(function(e,i){if(e>20&&e<30){var offset={x:i*blocksize,y:index*blocksize};_this3.render.minimap.beginFill("0x337733"),_this3.render.minimap.alpha=1,_this3.render.minimap.lineStyle(0,"0xffffff",1),_this3.render.minimap.drawRect(offset.x,offset.y,blocksize,blocksize),_this3.render.minimap.endFill()}else if(0!=e){var _offset={x:i*blocksize,y:index*blocksize};_this3.render.minimap.beginFill("0x333333"),_this3.render.minimap.alpha=1,_this3.render.minimap.lineStyle(0,"0xffffff",1),_this3.render.minimap.drawRect(_offset.x,_offset.y,blocksize,blocksize),_this3.render.minimap.endFill()}})})},this.draw.players=function(){var ship={width:40,height:60},shipX={point:ship.height/3*2,left:-(ship.height/3),right:-(ship.height/3)},shipY={point:0,left:-(ship.width/2),right:ship.width/2},icons={};icons.shield=$("<div />").html("&#xf132;").text(),icons.plus=$("<div />").html("&#xf067;").text(),icons.power=$("<div />").html("&#xf0e7;").text(),_this3.render.players.clear(),_this3.render.names.forEach(function(e,i){_this3.render.names[i].position.x=-1e4}),_this3.data.players.tick.forEach(function(e,i){if(0==e[4])return!1;var offset={x:e[1],y:e[2],r:e[3]/1e3},id=e[0],player=_this3.data.players.list["p"+id];if("undefined"==typeof player)return!1;var levelColor="0x000000";"undefined"!=typeof player.levelColor&&(levelColor=player.levelColor);var healthPercent=Math.floor(e[4]/10),drawDate=Date.now();_this3.data.oldPlayers.tick.forEach(function(ele,ind){e[0]==ele[0]&&(offset={x:Math.floor(Lib.betweenTwoNum(ele[1],e[1],(drawDate-e[e.length-1])/_this3.data.serverTick)),y:Math.floor(Lib.betweenTwoNum(ele[2],e[2],(drawDate-e[e.length-1])/_this3.data.serverTick)),r:offset.r})}),"undefined"==typeof _this3.render.names[id]&&(_this3.render.names[id]=new PIXI.Text("",{font:"bold 30px Arial",fill:"white",align:"center",stroke:"#000000",strokeThickness:6}),_this3.render.names[id].text=player.name,_this3.render.names[id].anchor.set(.5),_this3.render.text.addChild(_this3.render.names[id]),_this3.render.names[1e4+id]=new PIXI.Text("",{font:"35px fontAwesome",fill:"white",align:"center",stroke:"#000000",strokeThickness:6}),0==player.type&&(_this3.render.names[1e4+id].text=icons.power),1==player.type&&(_this3.render.names[1e4+id].text=icons.plus),2==player.type&&(_this3.render.names[1e4+id].text=icons.shield),_this3.render.names[1e4+id].anchor.set(.5),_this3.render.text.addChild(_this3.render.names[1e4+id])),_this3.render.names[id].position.x=offset.x,_this3.render.names[id].position.y=offset.y-100,_this3.render.names[1e4+id].style={font:"35px fontAwesome",fill:levelColor.replace("0x","#"),align:"center",stroke:"#000000",strokeThickness:6},_this3.render.names[1e4+id].position.x=offset.x+85,_this3.render.names[1e4+id].position.y=offset.y;var healthColor={};if("default"==_this3.data.config.health.color?(healthColor.full="0x00ff00",healthColor.empty="0xff0000",healthColor.outline="0x000000"):"class"==_this3.data.config.health.color?(console.log(player.type),0==player.type?(healthColor.full="0xff0000",healthColor.empty="0x333333",healthColor.outline="0x000000"):1==player.type?(healthColor.full="0x00ff00",healthColor.empty="0x333333",healthColor.outline="0x000000"):(healthColor.full="0x0000ff",healthColor.empty="0x333333",healthColor.outline="0x000000")):(healthColor.full=_this3.color.numToColor(player.color),healthColor.empty="0x333333",healthColor.outline="0x000000"),"bar"==_this3.data.config.health.style){var healthWidthMult=2;_this3.render.players.beginFill(healthColor.empty,_this3.data.config.health.alpha),_this3.render.players.lineStyle(3,healthColor.outline,_this3.data.config.health.alpha),_this3.render.players.drawRect(offset.x-50*healthWidthMult,offset.y-80,100*healthWidthMult,12),_this3.render.players.endFill(),_this3.render.players.beginFill(healthColor.full,_this3.data.config.health.alpha),_this3.render.players.lineStyle(3,healthColor.outline,_this3.data.config.health.alpha),_this3.render.players.drawRect(offset.x-50*healthWidthMult,offset.y-80,healthPercent*healthWidthMult,12),_this3.render.players.endFill()}else _this3.render.players.lineStyle(14,healthColor.outline,_this3.data.config.health.alpha),_this3.render.players.drawCircle(offset.x,offset.y,80),_this3.render.players.lineStyle(12,healthColor.full,_this3.data.config.health.alpha),_this3.render.players.moveTo(offset.x+80,offset.y),_this3.render.players.arc(offset.x,offset.y,80,0,2*Math.PI*(healthPercent/100),!1),_this3.render.players.lineStyle(12,healthColor.empty,_this3.data.config.health.alpha),_this3.render.players.moveTo(offset.x+80,offset.y),_this3.render.players.arc(offset.x,offset.y,80,0,2*Math.PI*(healthPercent/100),!0);_this3.render.players.beginFill(_this3.color.numToColor(player.color)),_this3.render.players.lineStyle(6,"0xFFFFFF",.5),_this3.render.players.moveTo(offset.x+(shipX.point*Math.cos(offset.r)-shipY.point*Math.sin(offset.r)),offset.y+(shipX.point*Math.sin(offset.r)+shipY.point*Math.cos(offset.r))),_this3.render.players.lineTo(offset.x+(shipX.left*Math.cos(offset.r)-shipY.left*Math.sin(offset.r)),offset.y+(shipX.left*Math.sin(offset.r)+shipY.left*Math.cos(offset.r))),_this3.render.players.lineTo(offset.x+(shipX.right*Math.cos(offset.r)-shipY.right*Math.sin(offset.r)),offset.y+(shipX.right*Math.sin(offset.r)+shipY.right*Math.cos(offset.r))),_this3.render.players.lineTo(offset.x+(shipX.point*Math.cos(offset.r)-shipY.point*Math.sin(offset.r)),offset.y+(shipX.point*Math.sin(offset.r)+shipY.point*Math.cos(offset.r))),_this3.render.players.endFill(),e[0]==_this3.data.myId&&(_this3.render.camera.position.x=-offset.x+Game.view.x/2,_this3.render.camera.position.y=-offset.y+Game.view.y/2)})},this.draw.miniplayers=function(){var blocksize=_this3.rendererMinimap.baseResolution.width/_this3.data.map.length,scale=blocksize/_this3.data.config.blocksize;_this3.render.miniplayers.clear();var player=_this3.data.players.list["p"+_this3.data.myId],drawDate=Date.now();_this3.data.players.minimap.forEach(function(e,i){var offset={x:e[0]*scale,y:e[1]*scale};_this3.data.oldPlayers.minimap.forEach(function(ele,ind){e[2]==ele[2]&&(offset={x:Math.floor(Lib.betweenTwoNum(ele[0],e[0],(drawDate-e[e.length-1])/_this3.data.minimapTick)*scale),y:Math.floor(Lib.betweenTwoNum(ele[1],e[1],(drawDate-e[e.length-1])/_this3.data.minimapTick)*scale)})}),e[2]==_this3.data.myId?(_this3.render.miniplayers.beginFill(_this3.color.numToColor(player.color)),_this3.render.miniplayers.lineStyle(4,"0xffffff",1),_this3.render.miniplayers.moveTo(offset.x,offset.y-13.2),_this3.render.miniplayers.lineTo(offset.x+10,offset.y+6.6),_this3.render.miniplayers.lineTo(offset.x-10,offset.y+6.6),_this3.render.miniplayers.lineTo(offset.x,offset.y-13.2),_this3.render.miniplayers.endFill()):(_this3.render.miniplayers.beginFill(_this3.color.numToColor(player.color)),_this3.render.miniplayers.lineStyle(4,"0xffffff",1),_this3.render.miniplayers.drawCircle(offset.x,offset.y,10),_this3.render.miniplayers.endFill())})},this.draw.lasers=function(){var frameTime=Date.now(),laserTimeout=100;_this3.render.lasers.clear();for(var i=0;i<_this3.data.lasers.length;i++){var age=frameTime-_this3.data.lasers[i][5];age>laserTimeout&&(_this3.data.lasers.splice(i,1),i--)}_this3.data.lasers.forEach(function(e,i){var offset={x1:e[0],y1:e[1],x2:e[2],y2:e[3]},owner=e[4],player=_this3.data.players.list["p"+owner];if("undefined"==typeof player)return!1;var age=frameTime-e[e.length-1],levelColor="0x000000";"undefined"!=typeof player.levelColor&&(levelColor=player.levelColor),_this3.render.lasers.lineStyle(12*(1-age/laserTimeout),levelColor,1),_this3.render.lasers.moveTo(offset.x1,offset.y1),_this3.render.lasers.lineTo(offset.x2,offset.y2)})},this.color={},this.color.componentToHex=function(c){var hex=c.toString(16);return 1==hex.length?"0"+hex:hex},this.color.rgbToHex=function(r,g,b){return"0x"+_this3.color.componentToHex(r)+_this3.color.componentToHex(g)+_this3.color.componentToHex(b)},this.color.hslToRgb=function(h,s,l){var r,g,b;if(0==s)r=g=b=l;else{var hue2rgb=function(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+(q-p)*(2/3-t)*6:p},q=l<.5?l*(1+s):l+s-l*s,p=2*l-q;r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)}return{r:Math.round(255*r),g:Math.round(255*g),b:Math.round(255*b)}},this.color.hslToHex=function(h,s,l){var x=_this3.color.hslToRgb(h,s,l);return _this3.color.rgbToHex(x.r,x.g,x.b)},this.color.numToColor=function(num){var colors=["0xffffff","0x800080","0x0000ff","0x00ff00","0xffff00","0xeb9447","0xff0000"];return"undefined"!=typeof colors[num]?colors[num]:colors[0]},this.color.randHex=function(){return _this3.color.rgbToHex(Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()))},$(window).on("resize",function(){var minimapWidth=$("#minimap").width(),minimapHeight=$("#minimap").height();_this3.rendererMinimap.resize(minimapWidth,minimapHeight),_this3.render.miniworld.scale.x=minimapWidth/_this3.rendererMinimap.baseResolution.width,_this3.render.miniworld.scale.y=minimapHeight/_this3.rendererMinimap.baseResolution.height;var width=$(window).width(),height=$(window).height();_this3.center={x:width/2,y:height/2},_this3.renderer.resize(width,height);var scale={};scale.w=width/_this3.renderer.baseResolution.width,scale.h=height/_this3.renderer.baseResolution.height,scale.largest=scale.w,scale.smallest=scale.h,scale.orentation="landscape",scale.h>scale.w&&(scale.largest=scale.h,scale.smallest=scale.w,scale.orentation="portrait"),scale.difference=scale.largest-scale.smallest,_this3.render.world.scale.x=scale.largest,_this3.render.world.scale.y=scale.largest,_this3.render.world.position.x=0,_this3.render.world.position.y=0,"portrait"==scale.orentation?_this3.render.world.position.x-=_this3.renderer.baseResolution.width*scale.difference/2:_this3.render.world.position.y-=_this3.renderer.baseResolution.height*scale.difference/2}),this.zoom(this.zoomLevel),this.animate()}return _createClass(GameClass,[{key:"zoom",value:function(x){1==x?(this.renderer.baseResolution.width=1500,this.renderer.baseResolution.height=750,this.view.x=1500,this.view.y=750):2==x?(this.renderer.baseResolution.width=2e3,this.renderer.baseResolution.height=1e3,this.view.x=2e3,this.view.y=1e3):3==x?(this.renderer.baseResolution.width=2500,this.renderer.baseResolution.height=1250,this.view.x=2500,this.view.y=1250):(this.renderer.baseResolution.width=3e3,this.renderer.baseResolution.height=1500,this.view.x=3e3,this.view.y=1500),this.zoomLevel=x,$(window).trigger("resize")}},{key:"executeMessage",value:function(msg){var parts=msg.split(" ");if(0==parts.length)return!1;if("//"==parts[0]){if("health"==parts[1])if("style"==parts[2])"bar"==parts[3]?this.data.config.health.style="bar":this.data.config.health.style="circle";else if("alpha"==parts[2]){var num=parseFloat(parts[3]);isNaN(num)||(this.data.config.health.alpha=num)}else"color"==parts[2]&&("default"==parts[3]?this.data.config.health.color="default":"class"==parts[3]?this.data.config.health.color="class":this.data.config.health.color="player");else if("background"==parts[1])"style"==parts[2]?("grid"==parts[3]?this.data.config.background.style="grid":this.data.config.background.style="colorfog",this.draw.map()):"color"==parts[2]&&("light"==parts[3]?this.data.config.background.color="light":this.data.config.background.color="dark",this.draw.map());else if("zoom"==parts[1]){var _num=parseInt(parts[2]);isNaN(_num)||this.zoom(_num)}else"id"==parts[1]?Game.chatMessage("Your ID is: "+this.data.myId,"game"):"ping"==parts[1]&&WS.sendObj({m:"ping",v:Date.now()});return!0}return!1}},{key:"chatMessage",value:function(msg,type){$("#chat-log").prepend($("<div />").addClass(type).text(msg))}},{key:"animate",value:function(){var _this4=this;requestAnimationFrame(function(){_this4.animate()}),this.draw.lasers(),this.draw.players(),this.draw.miniplayers(),this.renderer.render(this.render.world),this.rendererMinimap.render(this.render.miniworld)}}]),GameClass}(),Game=new GameClass;$("#enter-name-input").on("keyup",function(){PO.name=$(this).val()}),$(".type-button").on("click",function(){PO.type=$(this).attr("data-value"),WS.startWebSocket()}),$("#respawn-button").on("click",function(){WS.connected&&WS.server.send(JSON.stringify({m:"respawn"})),$("#respawn").addClass("hide")}),$("#respawn-leave").on("click",function(){WS.connected&&WS.server.close(),$("#respawn").addClass("hide")}),$("#waiting-cancel").on("click",function(){WS.connected&&WS.server.close()}),$(window).on("mousedown",function(e){return!PO.ready||void(0==e.button?PO.weapon(!0):2==e.button&&PO.thrust(!0))}),$(window).on("mouseup",function(e){return!PO.ready||void(0==e.button?PO.weapon(!1):2==e.button&&PO.thrust(!1))}),$(window).on("keydown",function(e){return!PO.ready||(PO.chatMode||(87==e.keyCode?PO.weapon(!0):32==e.keyCode&&PO.thrust(!0)),13!=e.keyCode&&9!=e.keyCode&&void 0)}),$(window).on("keyup",function(e){if(!PO.ready)return!0;if(PO.chatMode||(87==e.keyCode?PO.weapon(!1):32==e.keyCode&&PO.thrust(!1)),13==e.keyCode||9==e.keyCode){if(PO.chatMode){var msg=$("#actual-chat-box").val();Game.executeMessage(msg)||(PO.tick.message=msg,PO.tickchanged=!0),PO.chatMode=!1,$("#enter-chat").addClass("hide"),$("#actual-chat-box").blur().val("")}else PO.chatMode=!0,$("#enter-chat").removeClass("hide"),$("#actual-chat-box").focus();return!1}}),$(window).on("mousemove",function(e){if(!PO.ready)return!0;var mouse={X:e.clientX,Y:e.clientY},screen={W:$(window).width(),H:$(window).height()},delta={X:mouse.X-screen.W/2,Y:mouse.Y-screen.H/2},rad=Math.atan2(delta.Y,delta.X);PO.tick.direction=Math.floor(1e3*rad),PO.tickchanged=!0});