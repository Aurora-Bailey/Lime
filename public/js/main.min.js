"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var __DEV=!0,version=.001,compatible="9ICXM7PGXJ",__DOMAIN="example.com";String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Lib=function(){function Lib(){_classCallCheck(this,Lib)}return _createClass(Lib,null,[{key:"randString",value:function(length,lower,upper,numbers){var text="",possible="",possLower="abcdefghijklmnopqrstuvwxyz",possUpper="ABCDEFGHIJKLMNOPQRSTUVWXYZ";lower&&(possible+=possLower),upper&&(possible+=possUpper),numbers&&(possible+=posNum);for(var i=0;i<length;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}},{key:"weightedRandom",value:function(obj){var total=0;for(var key in obj)total+=obj[key];var r=Math.random()*total;for(var key in obj){if(r<obj[key])return key;r-=obj[key]}}},{key:"deepCopy",value:function(obj){return JSON.parse(JSON.stringify(obj))}},{key:"isObjEmpty",value:function(obj){if(null==obj)return!0;if(obj.length>0)return!1;if(0===obj.length)return!0;for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}},{key:"socialMediaPost",value:function(site,url){"facebook"==site?window.open("http://www.facebook.com/share.php?u="+url,"Facebook","width=550,height=400"):"twitter"==site&&window.open("http://twitter.com/intent/tweet?status="+url,"Twitter","width=550,height=400")}}]),Lib}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),WebSocketClass=function(){function WebSocketClass(){_classCallCheck(this,WebSocketClass),this.server=0,this.connected=!1}return _createClass(WebSocketClass,[{key:"startWebSocket",value:function(){var _this=this;return!this.connected&&(__DEV?this.server=new WebSocket("ws://localhost:7777"):this.server=new WebSocket("ws://ws."+__DOMAIN+"/"),this.server.onopen=function(){_this.connected=!0,$("#homepage").addClass("hide"),$("#maingame").removeClass("hide"),_this.sendObj({m:"compatible",v:compatible})},this.server.onclose=function(){_this.connected=!1,PO.ready=!1,$("#homepage").removeClass("hide"),$("#maingame").addClass("hide")},void(this.server.onmessage=function(e){var d=JSON.parse(e.data);if(console.log(d),"compatible"==d.m)0==d.v&&alert("Your game is out of date, try refreshing the browser.");else if("ready"==d.m)_this.sendObj({m:"start",n:PO.name,t:PO.type});else if("go"==d.m){PO.ready=!0;d.v}else"ping"==d.m&&console.log(Date.now()-parseInt(d.v))}))}},{key:"stopWebSocket",value:function(){this.connected&&this.server.close()}},{key:"sendObj",value:function(object){return 0==this.connected?(alert("WebSocket is not connected."),!1):void this.server.send(JSON.stringify(object))}}]),WebSocketClass}(),WS=new WebSocketClass,PlayerOutput=function(){function PlayerOutput(){_classCallCheck(this,PlayerOutput),this.ready=!1,this.name="",this.type=0,this.chatMode=!1,this.chatText="",this.thrusterState=!1,this.weaponState=!1,this.thrust=function(on){on&&0==this.thrusterState?(PO.tick.thruster=1,PO.thrusterState=!0,PO.tickchanged=!0):on||1!=this.thrusterState||(1==PO.tick.thruster?PO.tick.thruster=3:PO.tick.thruster=2,PO.thrusterState=!1,PO.tickchanged=!0)},this.weapon=function(on){on&&0==this.weaponState?(PO.tick.weapon=1,PO.weaponState=!0,PO.tickchanged=!0):on||1!=this.weaponState||(1==PO.tick.weapon?PO.tick.weapon=3:PO.tick.weapon=2,PO.weaponState=!1,PO.tickchanged=!0)},this.tickEmpty=0,this.tickchanged=!1,this.tick={},this.tick.direction=this.tickEmpty,this.tick.thruster=this.tickEmpty,this.tick.weapon=this.tickEmpty,this.tick.message=this.tickEmpty,this.loopDelay=50,this.harvestLoop()}return _createClass(PlayerOutput,[{key:"harvestLoop",value:function(){var _this2=this;if(setTimeout(function(){setTimeout(function(){_this2.harvestLoop()},1)},this.loopDelay),this.tickchanged){var tickArray=[2];for(var key in this.tick)this.tick.hasOwnProperty(key)&&(tickArray.push(this.tick[key]),this.tick[key]=this.tickEmpty);WS.connected&&WS.sendObj(tickArray),this.tickchanged=!1}}}]),PlayerOutput}(),PO=new PlayerOutput;$("#enter-name-input").on("keyup",function(){PO.name=$(this).val()}),$(".type-button").on("click",function(){PO.type=$(this).attr("data-value"),WS.startWebSocket()}),$(window).on("mousedown",function(e){return!PO.ready||void(0==e.button?PO.weapon(!0):2==e.button&&PO.thrust(!0))}),$(window).on("mouseup",function(e){return!PO.ready||void(0==e.button?PO.weapon(!1):2==e.button&&PO.thrust(!1))}),$(window).on("keydown",function(e){return!PO.ready||void(13==e.keyCode?PO.chatMode?(PO.tick.message=PO.chatText,PO.tickchanged=!0,PO.chatMode=!1,PO.chatText=""):PO.chatMode=!0:PO.chatMode?(e.keyCode>31&&e.keyCode<127&&(PO.chatText+=e.key),8==e.keyCode&&(PO.chatText=PO.chatText.slice(0,-1))):87==e.keyCode?PO.weapon(!0):32==e.keyCode&&PO.thrust(!0))}),$(window).on("keyup",function(e){return!PO.ready||void(PO.chatMode||(87==e.keyCode?PO.weapon(!1):32==e.keyCode&&PO.thrust(!1)))}),$(window).on("mousemove",function(e){if(!PO.ready)return!0;var mouse={X:e.clientX,Y:e.clientY},screen={W:$(window).width(),H:$(window).height()},delta={X:mouse.X-screen.W/2,Y:mouse.Y-screen.H/2},rad=Math.atan2(delta.Y,delta.X)+Math.PI;PO.tick.direction=Math.floor(1e3*rad),PO.tickchanged=!0});